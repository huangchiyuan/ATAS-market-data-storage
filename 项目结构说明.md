# 项目结构说明

## 目录结构

```
market_data_storage/
├── README.md                    # 主文档（使用说明）
├── SETUP.md                     # Git 仓库设置指南
├── LICENSE                      # MIT 许可证
├── requirements.txt             # Python 依赖包
├── .gitignore                   # Git 忽略文件
│
├── data_storage_module.py       # Python 数据接收和存储模块（主程序）
├── data_reader_for_backtest.py  # Python 数据读取工具
│
└── csharp/                      # C# 数据发送端
    ├── NFQE_Bridge_UDP.cs       # ATAS 指标源代码
    ├── ATASDataGateway.csproj   # C# 项目文件
    └── ATASDataGateway.sln      # Visual Studio 解决方案文件
```

## 文件说明

### Python 文件

- **`data_storage_module.py`**：
  - 主程序：接收 UDP 数据并存储到 DuckDB
  - 包含 `StorageModule`、`ReceiverThread`、`DbWriterThread` 等类
  - 运行方式：`python data_storage_module.py`

- **`data_reader_for_backtest.py`**：
  - 数据读取工具：从数据库读取数据供回测使用
  - 包含 `DataReaderForBacktest` 类
  - 支持单天、日期范围、最近N天等读取方式

### C# 文件

- **`csharp/NFQE_Bridge_UDP.cs`**：
  - ATAS 平台指标源代码
  - 从 ATAS 接收市场数据并通过 UDP 发送到 Python 端
  - 需要编译为 DLL 并部署到 ATAS 平台

- **`csharp/ATASDataGateway.csproj`**：
  - C# 项目配置文件
  - 包含 ATAS 平台 DLL 引用路径（需要根据实际安装路径修改）

- **`csharp/ATASDataGateway.sln`**：
  - Visual Studio 解决方案文件
  - 使用 Visual Studio 2022 打开并编译

## 数据库文件

数据库文件默认存储在 `market_data_db/` 文件夹中（不在仓库中，由 `.gitignore` 排除）：
```
market_data_db/
├── market_data_2025-12-01.duckdb
├── market_data_2025-12-02.duckdb
└── ...
```

## 使用流程

1. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

2. **编译 C# 代码**：
   - 使用 Visual Studio 2022 打开 `csharp/ATASDataGateway.sln`
   - 编译项目（Release 模式）
   - 将生成的 DLL 部署到 ATAS 平台

3. **启动数据存储**：
   ```bash
   python data_storage_module.py
   ```

4. **在 ATAS 中加载指标**：
   - 添加 `NFQE_Bridge_UDP` 指标到图表
   - 配置 Python IP 和 Port

5. **读取数据**：
   ```python
   from data_reader_for_backtest import DataReaderForBacktest
   reader = DataReaderForBacktest()
   df_ticks, df_depth = reader.load_date_range("2025-12-01", "2025-12-07", "ES")
   ```

